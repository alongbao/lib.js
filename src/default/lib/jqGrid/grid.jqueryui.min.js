(function($){$.browser.msie&&$.browser.version==8&&($.expr[":"].hidden=function(a){return a.offsetWidth===0||a.offsetHeight===0||a.style.display=="none"}),$.jgrid._multiselect=!1;if($.ui&&$.ui.multiselect){if($.ui.multiselect.prototype._setSelected){var setSelected=$.ui.multiselect.prototype._setSelected;$.ui.multiselect.prototype._setSelected=function(a,b){var c=setSelected.call(this,a,b);if(b&&this.selectedList){var d=this.element;this.selectedList.find("li").each(function(){$(this).data("optionLink")&&$(this).data("optionLink").remove().appendTo(d)})}return c}}$.ui.multiselect.prototype.destroy&&($.ui.multiselect.prototype.destroy=function(){this.element.show(),this.container.remove(),$.Widget===undefined?$.widget.prototype.destroy.apply(this,arguments):$.Widget.prototype.destroy.apply(this,arguments)}),$.jgrid._multiselect=!0}$.jgrid.extend({sortableColumns:function(a){return this.each(function(){function d(){b.p.disableClick=!0}var b=this,c=b.p.id,e={tolerance:"pointer",axis:"x",scrollSensitivity:"1",items:">th:not(:has(#jqgh_"+c+"_cb"+",#jqgh_"+c+"_rn"+",#jqgh_"+c+"_subgrid),:hidden)",placeholder:{element:function(a){var b=$(document.createElement(a[0].nodeName)).addClass(a[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0];return b},update:function(a,b){b.height(a.currentItem.innerHeight()-parseInt(a.currentItem.css("paddingTop")||0,10)-parseInt(a.currentItem.css("paddingBottom")||0,10)),b.width(a.currentItem.innerWidth()-parseInt(a.currentItem.css("paddingLeft")||0,10)-parseInt(a.currentItem.css("paddingRight")||0,10))}},update:function(a,c){var d=$(c.item).parent(),e=$(">th",d),f=b.p.colModel,g={},h=b.p.id+"_";$.each(f,function(a){g[this.name]=a});var i=[];e.each(function(a){var b=$(">div",this).get(0).id.replace(/^jqgh_/,"").replace(h,"");b in g&&i.push(g[b])}),$(b).jqGrid("remapColumns",i,!0,!0),$.isFunction(b.p.sortable.update)&&b.p.sortable.update(i),setTimeout(function(){b.p.disableClick=!1},50)}};b.p.sortable.options?$.extend(e,b.p.sortable.options):$.isFunction(b.p.sortable)&&(b.p.sortable={update:b.p.sortable});if(e.start){var f=e.start;e.start=function(a,b){d(),f.call(this,a,b)}}else e.start=d;b.p.sortable.exclude&&(e.items+=":not("+b.p.sortable.exclude+")"),a.sortable(e).data("sortable").floating=!0})},columnChooser:function(a){function j(a,b){!a||(typeof a=="string"?$.fn[a]&&$.fn[a].apply(b,$.makeArray(arguments).slice(2)):$.isFunction(a)&&a.apply(b,$.makeArray(arguments).slice(2)))}function e(a,b,c){if(b>=0){var d=a.slice(),e=d.splice(b,Math.max(a.length-b,b));b>a.length&&(b=a.length),d[b]=c;return d.concat(e)}}var b=this;if(!$("#colchooser_"+b[0].p.id).length){var c=$('<div id="colchooser_'+b[0].p.id+'" style="position:relative;overflow:hidden"><div><select multiple="multiple"></select></div></div>'),d=$("select",c);a=$.extend({width:420,height:240,classname:null,done:function(a){a&&b.jqGrid("remapColumns",a,!0)},msel:"multiselect",dlog:"dialog",dlog_opts:function(a){var b={};b[a.bSubmit]=function(){a.apply_perm(),a.cleanup(!1)},b[a.bCancel]=function(){a.cleanup(!0)};return{buttons:b,close:function(){a.cleanup(!0)},modal:a.modal?a.modal:!1,resizable:a.resizable?a.resizable:!0,width:a.width+20}},apply_perm:function(){$("option",d).each(function(a){this.selected?b.jqGrid("showCol",f[this.value].name):b.jqGrid("hideCol",f[this.value].name)});var c=[];$("option[selected]",d).each(function(){c.push(parseInt(this.value,10))}),$.each(c,function(){delete h[f[parseInt(this,10)].name]}),$.each(h,function(){var a=parseInt(this,10);c=e(c,a,a)}),a.done&&a.done.call(b,c)},cleanup:function(e){j(a.dlog,c,"destroy"),j(a.msel,d,"destroy"),c.remove(),e&&a.done&&a.done.call(b)},msel_opts:{}},$.jgrid.col,a||{});if($.ui&&$.ui.multiselect&&a.msel=="multiselect"){if(!$.jgrid._multiselect){alert("Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!");return}a.msel_opts=$.extend($.ui.multiselect.defaults,a.msel_opts)}a.caption&&c.attr("title",a.caption),a.classname&&(c.addClass(a.classname),d.addClass(a.classname)),a.width&&($(">div",c).css({width:a.width,margin:"0 auto"}),d.css("width",a.width)),a.height&&($(">div",c).css("height",a.height),d.css("height",a.height-10));var f=b.jqGrid("getGridParam","colModel"),g=b.jqGrid("getGridParam","colNames"),h={},i=[];d.empty(),$.each(f,function(a){h[this.name]=a,this.hidedlg?this.hidden||i.push(a):d.append("<option value='"+a+"' "+(this.hidden?"":"selected='selected'")+">"+g[a]+"</option>")});var k=$.isFunction(a.dlog_opts)?a.dlog_opts.call(b,a):a.dlog_opts;j(a.dlog,c,k);var l=$.isFunction(a.msel_opts)?a.msel_opts.call(b,a):a.msel_opts;j(a.msel,d,l)}},sortableRows:function(a){return this.each(function(){var b=this;if(!!b.grid){if(b.p.treeGrid)return;$.fn.sortable&&(a=$.extend({cursor:"move",axis:"y",items:".jqgrow"},a||{}),a.start&&$.isFunction(a.start)?(a._start_=a.start,delete a.start):a._start_=!1,a.update&&$.isFunction(a.update)?(a._update_=a.update,delete a.update):a._update_=!1,a.start=function(c,d){$(d.item).css("border-width","0px"),$("td",d.item).each(function(a){this.style.width=b.grid.cols[a].style.width});if(b.p.subGrid){var e=$(d.item).attr("id");try{$(b).jqGrid("collapseSubGridRow",e)}catch(f){}}a._start_&&a._start_.apply(this,[c,d])},a.update=function(c,d){$(d.item).css("border-width",""),b.p.rownumbers===!0&&$("td.jqgrid-rownum",b.rows).each(function(a){$(this).html(a+1)}),a._update_&&a._update_.apply(this,[c,d])},$("tbody:first",b).sortable(a),$("tbody:first",b).disableSelection())}})},gridDnD:function(a){return this.each(function(){function c(){var a=$.data(b,"dnd");$("tr.jqgrow:not(.ui-draggable)",b).draggable($.isFunction(a.drag)?a.drag.call($(b),a):a.drag)}var b=this;if(!!b.grid){if(b.p.treeGrid)return;if(!$.fn.draggable||!$.fn.droppable)return;var d="<table id='jqgrid_dnd' class='ui-jqgrid-dnd'></table>";$("#jqgrid_dnd").html()===null&&$("body").append(d);if(typeof a=="string"&&a=="updateDnD"&&b.p.jqgdnd===!0){c();return}a=$.extend({drag:function(a){return $.extend({start:function(c,d){if(b.p.subGrid){var e=$(d.helper).attr("id");try{$(b).jqGrid("collapseSubGridRow",e)}catch(f){}}for(var g=0;g<$.data(b,"dnd").connectWith.length;g++)$($.data(b,"dnd").connectWith[g]).jqGrid("getGridParam","reccount")=="0"&&$($.data(b,"dnd").connectWith[g]).jqGrid("addRowData","jqg_empty_row",{});d.helper.addClass("ui-state-highlight"),$("td",d.helper).each(function(a){this.style.width=b.grid.headers[a].width+"px"}),a.onstart&&$.isFunction(a.onstart)&&a.onstart.call($(b),c,d)},stop:function(c,d){if(d.helper.dropped){var e=$(d.helper).attr("id");$(b).jqGrid("delRowData",e)}for(var f=0;f<$.data(b,"dnd").connectWith.length;f++)$($.data(b,"dnd").connectWith[f]).jqGrid("delRowData","jqg_empty_row");a.onstop&&$.isFunction(a.onstop)&&a.onstop.call($(b),c,d)}},a.drag_opts||{})},drop:function(a){return $.extend({accept:function(a){if(!$(a).hasClass("jqgrow"))return a;var b=$(a).closest("table.ui-jqgrid-btable");if(b.length>0&&$.data(b[0],"dnd")!==undefined){var c=$.data(b[0],"dnd").connectWith;return $.inArray("#"+this.id,c)!=-1?!0:!1}return a},drop:function(c,d){if(!!$(d.draggable).hasClass("jqgrow")){var e=$(d.draggable).attr("id"),f=d.draggable.parent().parent().jqGrid("getRowData",e);if(!a.dropbyname){var g=0,h={},i,j=$("#"+this.id).jqGrid("getGridParam","colModel");try{for(var k in f)f.hasOwnProperty(k)&&j[g]&&(i=j[g].name,h[i]=f[k]),g++;f=h}catch(l){}}d.helper.dropped=!0;if(a.beforedrop&&$.isFunction(a.beforedrop)){var m=a.beforedrop.call(this,c,d,f,$("#"+b.id),$(this));typeof m!="undefined"&&m!==null&&typeof m=="object"&&(f=m)}if(d.helper.dropped){var n;a.autoid&&($.isFunction(a.autoid)?n=a.autoid.call(this,f):(n=Math.ceil(Math.random()*1e3),n=a.autoidprefix+n)),$("#"+this.id).jqGrid("addRowData",n,f,a.droppos)}a.ondrop&&$.isFunction(a.ondrop)&&a.ondrop.call(this,c,d,f)}}},a.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{activeClass:"ui-state-active",hoverClass:"ui-state-hover"},drag_opts:{revert:"invalid",helper:"clone",cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5e3},dropbyname:!1,droppos:"first",autoid:!0,autoidprefix:"dnd_"},a||{});if(!a.connectWith)return;a.connectWith=a.connectWith.split(","),a.connectWith=$.map(a.connectWith,function(a){return $.trim(a)}),$.data(b,"dnd",a),b.p.reccount!="0"&&!b.p.jqgdnd&&c(),b.p.jqgdnd=!0;for(var e=0;e<a.connectWith.length;e++){var f=a.connectWith[e];$(f).droppable($.isFunction(a.drop)?a.drop.call($(b),a):a.drop)}}})},gridResize:function(opts){return this.each(function(){var $t=this;if(!!$t.grid&&!!$.fn.resizable){opts=$.extend({},opts||{}),opts.alsoResize?(opts._alsoResize_=opts.alsoResize,delete opts.alsoResize):opts._alsoResize_=!1,opts.stop&&$.isFunction(opts.stop)?(opts._stop_=opts.stop,delete opts.stop):opts._stop_=!1,opts.stop=function(a,b){$($t).jqGrid("setGridParam",{height:$("#gview_"+$t.p.id+" .ui-jqgrid-bdiv").height()}),$($t).jqGrid("setGridWidth",b.size.width,opts.shrinkToFit),opts._stop_&&opts._stop_.call($t,a,b)};if(opts._alsoResize_){var optstest="{'#gview_"+$t.p.id+" .ui-jqgrid-bdiv':true,'"+opts._alsoResize_+"':true}";opts.alsoResize=eval("("+optstest+")")}else opts.alsoResize=$(".ui-jqgrid-bdiv","#gview_"+$t.p.id);delete opts._alsoResize_,$("#gbox_"+$t.p.id).resizable(opts)}})}})})(jQuery)