(function(a){a.jgrid.extend({getColProp:function(a){var b={},c=this[0];if(!c.grid)return!1;var d=c.p.colModel;for(var e=0;e<d.length;e++)if(d[e].name==a){b=d[e];break}return b},setColProp:function(b,c){return this.each(function(){if(this.grid&&c){var d=this.p.colModel;for(var e=0;e<d.length;e++)if(d[e].name==b){a.extend(this.p.colModel[e],c);break}}})},sortGrid:function(a,b,c){return this.each(function(){var d=this,e=-1;if(!!d.grid){a||(a=d.p.sortname);for(var f=0;f<d.p.colModel.length;f++)if(d.p.colModel[f].index==a||d.p.colModel[f].name==a){e=f;break}if(e!=-1){var g=d.p.colModel[e].sortable;typeof g!="boolean"&&(g=!0),typeof b!="boolean"&&(b=!1),g&&d.sortData("jqgh_"+d.p.id+"_"+a,e,b,c)}}})},GridDestroy:function(){return this.each(function(){if(this.grid){this.p.pager&&a(this.p.pager).remove();var b=this.id;try{a("#gbox_"+b).remove()}catch(c){}}})},GridUnload:function(){return this.each(function(){if(!!this.grid){var b={id:a(this).attr("id"),cl:a(this).attr("class")};this.p.pager&&a(this.p.pager).empty().removeClass("ui-state-default ui-jqgrid-pager corner-bottom");var c=document.createElement("table");a(c).attr({id:b.id}),c.className=b.cl;var d=this.id;a(c).removeClass("ui-jqgrid-btable"),a(this.p.pager).parents("#gbox_"+d).length===1?(a(c).insertBefore("#gbox_"+d).show(),a(this.p.pager).insertBefore("#gbox_"+d)):a(c).insertBefore("#gbox_"+d).show(),a("#gbox_"+d).remove()}})},setGridState:function(b){return this.each(function(){if(!!this.grid){var c=this;b=="hidden"?(a(".ui-jqgrid-bdiv, .ui-jqgrid-hdiv","#gview_"+c.p.id).slideUp("fast"),c.p.pager&&a(c.p.pager).slideUp("fast"),c.p.toppager&&a(c.p.toppager).slideUp("fast"),c.p.toolbar[0]===!0&&(c.p.toolbar[1]=="both"&&a(c.grid.ubDiv).slideUp("fast"),a(c.grid.uDiv).slideUp("fast")),c.p.footerrow&&a(".ui-jqgrid-sdiv","#gbox_"+c.p.id).slideUp("fast"),a(".ui-jqgrid-titlebar-close span",c.grid.cDiv).removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),c.p.gridstate="hidden"):b=="visible"&&(a(".ui-jqgrid-hdiv, .ui-jqgrid-bdiv","#gview_"+c.p.id).slideDown("fast"),c.p.pager&&a(c.p.pager).slideDown("fast"),c.p.toppager&&a(c.p.toppager).slideDown("fast"),c.p.toolbar[0]===!0&&(c.p.toolbar[1]=="both"&&a(c.grid.ubDiv).slideDown("fast"),a(c.grid.uDiv).slideDown("fast")),c.p.footerrow&&a(".ui-jqgrid-sdiv","#gbox_"+c.p.id).slideDown("fast"),a(".ui-jqgrid-titlebar-close span",c.grid.cDiv).removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n"),c.p.gridstate="visible")}})},filterToolbar:function(b){b=a.extend({autosearch:!0,searchOnEnter:!0,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,searchurl:"",stringResult:!1,groupOp:"AND",defaultSearch:"bw"},b||{});return this.each(function(){function g(b,c){var d=a(b);d[0]&&jQuery.each(c,function(){this.data!==undefined?d.bind(this.type,this.data,this.fn):d.bind(this.type,this.fn)})}var c=this;if(!this.ftoolbar){var d=function(){var d={},e=0,f,g,h={},i;a.each(c.p.colModel,function(j,k){g=this.index||this.name;switch(this.stype){case"select":i=this.searchoptions&&this.searchoptions.sopt?this.searchoptions.sopt[0]:"eq",f=a("#gs_"+a.jgrid.jqID(this.name),c.grid.hDiv).val();if(f)d[g]=f,h[g]=i,e++;else try{delete c.p.postData[g]}catch(l){}break;case"text":i=this.searchoptions&&this.searchoptions.sopt?this.searchoptions.sopt[0]:b.defaultSearch,f=a("#gs_"+a.jgrid.jqID(this.name),c.grid.hDiv).val();if(f)d[g]=f,h[g]=i,e++;else try{delete c.p.postData[g]}catch(m){}}});var j=e>0?!0:!1;if(b.stringResult===!0||c.p.datatype=="local"){var k='{"groupOp":"'+b.groupOp+'","rules":[',l=0;a.each(d,function(a,b){l>0&&(k+=","),k+='{"field":"'+a+'",',k+='"op":"'+h[a]+'",',b+="",k+='"data":"'+b.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',l++}),k+="]}",a.extend(c.p.postData,{filters:k}),a.each(["searchField","searchString","searchOper"],function(a,b){c.p.postData.hasOwnProperty(b)&&delete c.p.postData[b]})}else a.extend(c.p.postData,d);var m;c.p.searchurl&&(m=c.p.url,a(c).jqGrid("setGridParam",{url:c.p.searchurl}));var n=!1;a.isFunction(b.beforeSearch)&&(n=b.beforeSearch.call(c)),n||a(c).jqGrid("setGridParam",{search:j}).trigger("reloadGrid",[{page:1}]),m&&a(c).jqGrid("setGridParam",{url:m}),a.isFunction(b.afterSearch)&&b.afterSearch()},e=function(d){var e={},f,g=0,h;d=typeof d!="boolean"?!0:d,a.each(c.p.colModel,function(b,d){f=this.searchoptions&&this.searchoptions.defaultValue?this.searchoptions.defaultValue:"",h=this.index||this.name;switch(this.stype){case"select":var i;a("#gs_"+a.jgrid.jqID(h)+" option",c.grid.hDiv).each(function(b){b===0&&(this.selected=!0);if(a(this).text()==f){this.selected=!0,i=a(this).val();return!1}});if(i)e[h]=i,g++;else try{delete c.p.postData[h]}catch(j){}break;case"text":a("#gs_"+a.jgrid.jqID(h),c.grid.hDiv).val(f);if(f)e[h]=f,g++;else try{delete c.p.postData[h]}catch(k){}}});var i=g>0?!0:!1;if(b.stringResult===!0||c.p.datatype=="local"){var j='{"groupOp":"'+b.groupOp+'","rules":[',k=0;a.each(e,function(a,b){k>0&&(j+=","),j+='{"field":"'+a+'",',j+='"op":"eq",',b+="",j+='"data":"'+b.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',k++}),j+="]}",a.extend(c.p.postData,{filters:j}),a.each(["searchField","searchString","searchOper"],function(a,b){c.p.postData.hasOwnProperty(b)&&delete c.p.postData[b]})}else a.extend(c.p.postData,e);var l;c.p.searchurl&&(l=c.p.url,a(c).jqGrid("setGridParam",{url:c.p.searchurl}));var m=!1;a.isFunction(b.beforeClear)&&(m=b.beforeClear.call(c)),m||d&&a(c).jqGrid("setGridParam",{search:i}).trigger("reloadGrid",[{page:1}]),l&&a(c).jqGrid("setGridParam",{url:l}),a.isFunction(b.afterClear)&&b.afterClear()},f=function(){var b=a("tr.ui-search-toolbar",c.grid.hDiv);b.css("display")=="none"?b.show():b.hide()},h=a("<tr class='ui-search-toolbar' role='rowheader'></tr>"),i;a.each(c.p.colModel,function(e,f){var j=this,k,l,m,n,o;l=a("<th role='columnheader' class='ui-state-default ui-th-column ui-th-"+c.p.direction+"'></th>"),k=a("<div style='width:100%;position:relative;height:100%;padding-right:0.3em;'></div>"),this.hidden===!0&&a(l).css("display","none"),this.search=this.search===!1?!1:!0,typeof this.stype=="undefined"&&(this.stype="text"),m=a.extend({},this.searchoptions||{});if(this.search)switch(this.stype){case"select":n=this.surl||m.dataUrl;if(n)o=k,a.ajax(a.extend({url:n,dataType:"html",complete:function(c,e){if(m.buildSelect!==undefined){var f=m.buildSelect(c);f&&a(o).append(f)}else a(o).append(c.responseText);m.defaultValue&&a("select",o).val(m.defaultValue),a("select",o).attr({name:j.index||j.name,id:"gs_"+j.name}),m.attr&&a("select",o).attr(m.attr),a("select",o).css({width:"100%"}),m.dataInit!==undefined&&m.dataInit(a("select",o)[0]),m.dataEvents!==undefined&&g(a("select",o)[0],m.dataEvents),b.autosearch===!0&&a("select",o).change(function(a){d();return!1}),c=null}},a.jgrid.ajaxOptions,c.p.ajaxSelectOptions||{}));else{var q;j.searchoptions&&j.searchoptions.value?q=j.searchoptions.value:j.editoptions&&j.editoptions.value&&(q=j.editoptions.value);if(q){var r=document.createElement("select");r.style.width="100%",a(r).attr({name:j.index||j.name,id:"gs_"+j.name});var s,t,u;if(typeof q=="string"){s=q.split(";");for(var v=0;v<s.length;v++)t=s[v].split(":"),u=document.createElement("option"),u.value=t[0],u.innerHTML=t[1],r.appendChild(u)}else if(typeof q=="object")for(var w in q)q.hasOwnProperty(w)&&(u=document.createElement("option"),u.value=w,u.innerHTML=q[w],r.appendChild(u));m.defaultValue&&a(r).val(m.defaultValue),m.attr&&a(r).attr(m.attr),m.dataInit!==undefined&&m.dataInit(r),m.dataEvents!==undefined&&g(r,m.dataEvents),a(k).append(r),b.autosearch===!0&&a(r).change(function(a){d();return!1})}}break;case"text":var x=m.defaultValue?m.defaultValue:"";a(k).append("<input type='text' style='width:95%;padding:0px;' name='"+(j.index||j.name)+"' id='gs_"+j.name+"' value='"+x+"'/>"),m.attr&&a("input",k).attr(m.attr),m.dataInit!==undefined&&m.dataInit(a("input",k)[0]),m.dataEvents!==undefined&&g(a("input",k)[0],m.dataEvents),b.autosearch===!0&&(b.searchOnEnter?a("input",k).keypress(function(a){var b=a.charCode?a.charCode:a.keyCode?a.keyCode:0;if(b==13){d();return!1}return this}):a("input",k).keydown(function(a){var b=a.which;switch(b){case 13:return!1;case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;default:i&&clearTimeout(i),i=setTimeout(function(){d()},500)}}))}a(l).append(k),a(h).append(l)}),a("table thead",c.grid.hDiv).append(h),this.ftoolbar=!0,this.triggerToolbar=d,this.clearToolbar=e,this.toggleToolbar=f}})}})})(jQuery)