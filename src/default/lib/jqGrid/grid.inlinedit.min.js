(function(a){a.jgrid.extend({editRow:function(b,c,d,e,f,g,h,i,j){var k={keys:c||!1,oneditfunc:d||null,successfunc:e||null,url:f||null,extraparam:g||{},aftersavefunc:h||null,errorfunc:i||null,afterrestorefunc:j||null,restoreAfterErorr:!0},l=a.makeArray(arguments).slice(1),m;l[0]&&typeof l[0]=="object"&&!a.isFunction(l[0])?m=a.extend(k,l[0]):m=k;return this.each(function(){var c=this,d,e,f,g=0,h=null,i={},k,l;if(!!c.grid){k=a(c).jqGrid("getInd",b,!0);if(k===!1)return;f=a(k).attr("editable")||"0",f=="0"&&!a(k).hasClass("not-editable-row")&&(l=c.p.colModel,a("td",k).each(function(f){d=l[f].name;var j=c.p.treeGrid===!0&&d==c.p.ExpandColumn;if(j)e=a("span:first",this).html();else try{e=a.unformat(this,{rowId:b,colModel:l[f]},f)}catch(k){e=l[f].edittype&&l[f].edittype=="textarea"?a(this).text():a(this).html()}if(d!="cb"&&d!="subgrid"&&d!="rn"){c.p.autoencode&&(e=a.jgrid.htmlDecode(e)),i[d]=e;if(l[f].editable===!0){h===null&&(h=f),j?a("span:first",this).html(""):a(this).html("");var m=a.extend({},l[f].editoptions||{},{id:b+"_"+d,name:d});l[f].edittype||(l[f].edittype="text");if(e=="&nbsp;"||e=="&#160;"||e.length==1&&e.charCodeAt(0)==160)e="";var n=a.jgrid.createEl(l[f].edittype,m,e,!0,a.extend({},a.jgrid.ajaxOptions,c.p.ajaxSelectOptions||{}));a(n).addClass("editable"),j?a("span:first",this).append(n):a(this).append(n),l[f].edittype=="select"&&l[f].editoptions.multiple===!0&&a.browser.msie&&a(n).width(a(n).width()),g++}}}),g>0&&(i.id=b,c.p.savedRow.push(i),a(k).attr("editable","1"),a("td:eq("+h+") input",k).focus(),m.keys===!0&&a(k).bind("keydown",function(d){d.keyCode===27&&a(c).jqGrid("restoreRow",b,j);if(d.keyCode===13){var e=d.target;if(e.tagName=="TEXTAREA")return!0;a(c).jqGrid("saveRow",b,m);return!1}d.stopPropagation()}),a.isFunction(m.oneditfunc)&&m.oneditfunc.call(c,b)))}})},saveRow:function(b,c,d,e,f,g,h){var i={successfunc:c||null,url:d||null,extraparam:e||{},aftersavefunc:f||null,errorfunc:g||null,afterrestorefunc:h||null,restoreAfterErorr:!0},j=a.makeArray(arguments).slice(1),k;j[0]&&typeof j[0]=="object"&&!a.isFunction(j[0])?k=a.extend(i,j[0]):k=i;var l=!1,m=this[0],n,o={},p={},q={},r,s,t,u;if(!m.grid)return l;u=a(m).jqGrid("getInd",b,!0);if(u===!1)return l;r=a(u).attr("editable"),k.url=k.url?k.url:m.p.editurl;if(r==="1"){var v;a("td",u).each(function(b){v=m.p.colModel[b],n=v.name;if(n!="cb"&&n!="subgrid"&&v.editable===!0&&n!="rn"&&!a(this).hasClass("not-editable-cell")){switch(v.edittype){case"checkbox":var c=["Yes","No"];v.editoptions&&(c=v.editoptions.value.split(":")),o[n]=a("input",this).attr("checked")?c[0]:c[1];break;case"text":case"password":case"textarea":case"button":o[n]=a("input, textarea",this).val();break;case"select":if(!v.editoptions.multiple)o[n]=a("select>option:selected",this).val(),p[n]=a("select>option:selected",this).text();else{var d=a("select",this),e=[];o[n]=a(d).val(),o[n]?o[n]=o[n].join(","):o[n]="",a("select > option:selected",this).each(function(b,c){e[b]=a(c).text()}),p[n]=e.join(",")}v.formatter&&v.formatter=="select"&&(p={});break;case"custom":try{if(!v.editoptions||!a.isFunction(v.editoptions.custom_value))throw"e1";o[n]=v.editoptions.custom_value.call(m,a(".customelement",this),"get");if(o[n]===undefined)throw"e2"}catch(f){f=="e1"&&a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+a.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose),f=="e2"?a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+a.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose):a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,f.message,jQuery.jgrid.edit.bClose)}}t=a.jgrid.checkValues(o[n],b,m);if(t[0]===!1){t[1]=o[n]+" "+t[1];return!1}m.p.autoencode&&(o[n]=a.jgrid.htmlEncode(o[n])),k.url!=="clientArray"&&v.editoptions&&v.editoptions.NullIfEmpty===!0&&o[n]==""&&(q[n]="null")}});if(t[0]===!1){try{var w=a.jgrid.findPos(a("#"+a.jgrid.jqID(b),m.grid.bDiv)[0]);a.jgrid.info_dialog(a.jgrid.errors.errcap,t[1],a.jgrid.edit.bClose,{left:w[0],top:w[1]})}catch(x){alert(t[1])}return l}if(o){var y,z,A;z=m.p.prmNames,A=z.oper,y=z.id,o[A]=z.editoper,o[y]=b,typeof m.p.inlineData=="undefined"&&(m.p.inlineData={}),o=a.extend({},o,m.p.inlineData,k.extraparam)}if(k.url=="clientArray"){o=a.extend({},o,p),m.p.autoencode&&a.each(o,function(b,c){o[b]=a.jgrid.htmlDecode(c)});var B=a(m).jqGrid("setRowData",b,o);a(u).attr("editable","0");for(var C=0;C<m.p.savedRow.length;C++)if(m.p.savedRow[C].id==b){s=C;break}s>=0&&m.p.savedRow.splice(s,1),a.isFunction(k.aftersavefunc)&&k.aftersavefunc.call(m,b,B),l=!0}else a("#lui_"+m.p.id).show(),q=a.extend({},o,q),a.ajax(a.extend({url:k.url,data:a.isFunction(m.p.serializeRowData)?m.p.serializeRowData.call(m,q):q,type:"POST",async:!1,complete:function(c,d){a("#lui_"+m.p.id).hide();if(d==="success"){var e;a.isFunction(k.successfunc)?e=k.successfunc.call(m,c):e=!0;if(e===!0){m.p.autoencode&&a.each(o,function(b,c){o[b]=a.jgrid.htmlDecode(c)}),o=a.extend({},o,p),a(m).jqGrid("setRowData",b,o),a(u).attr("editable","0");for(var f=0;f<m.p.savedRow.length;f++)if(m.p.savedRow[f].id==b){s=f;break}s>=0&&m.p.savedRow.splice(s,1),a.isFunction(k.aftersavefunc)&&k.aftersavefunc.call(m,b,c),l=!0}else a.isFunction(k.errorfunc)&&k.errorfunc.call(m,b,c,d),k.restoreAfterError===!0&&a(m).jqGrid("restoreRow",b,k.afterrestorefunc)}},error:function(c,d){a("#lui_"+m.p.id).hide();if(a.isFunction(k.errorfunc))k.errorfunc.call(m,b,c,d);else try{jQuery.jgrid.info_dialog(jQuery.jgrid.errors.errcap,'<div class="ui-state-error">'+c.responseText+"</div>",jQuery.jgrid.edit.bClose,{buttonalign:"right"})}catch(e){alert(c.responseText)}k.restoreAfterError===!0&&a(m).jqGrid("restoreRow",b,k.afterrestorefunc)}},a.jgrid.ajaxOptions,m.p.ajaxRowOptions||{}));a(u).unbind("keydown")}return l},restoreRow:function(b,c){return this.each(function(){var d=this,e,f,g={};if(!!d.grid){f=a(d).jqGrid("getInd",b,!0);if(f===!1)return;for(var h=0;h<d.p.savedRow.length;h++)if(d.p.savedRow[h].id==b){e=h;break}if(e>=0){if(a.isFunction(a.fn.datepicker))try{a("input.hasDatepicker","#"+a.jgrid.jqID(f.id)).datepicker("hide")}catch(i){}a.each(d.p.colModel,function(b,c){this.editable===!0&&this.name in d.p.savedRow[e]&&!a(this).hasClass("not-editable-cell")&&(g[this.name]=d.p.savedRow[e][this.name])}),a(d).jqGrid("setRowData",b,g),a(f).attr("editable","0").unbind("keydown"),d.p.savedRow.splice(e,1)}a.isFunction(c)&&c.call(d,b)}})}})})(jQuery)