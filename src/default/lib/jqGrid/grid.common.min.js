(function(a){a.extend(a.jgrid,{showModal:function(a){a.w.show()},closeModal:function(a){a.w.hide().attr("aria-hidden","true"),a.o&&a.o.remove()},hideModal:function(b,c){c=a.extend({jqm:!0,gb:""},c||{});if(c.onClose){var d=c.onClose(b);if(typeof d=="boolean"&&!d)return}if(a.fn.jqm&&c.jqm===!0)a(b).attr("aria-hidden","true").jqmHide();else{if(c.gb!=="")try{a(".jqgrid-overlay:first",c.gb).hide()}catch(e){}a(b).hide().attr("aria-hidden","true")}},findPos:function(a){var b=0,c=0;if(a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return[b,c]},createModal:function(b,c,d,e,f,g,h){var i=document.createElement("div"),j,k=this;h=a.extend({},h||{}),j=a(d.gbox).attr("dir")=="rtl"?!0:!1,i.className="ui-widget ui-widget-content ui-corner-all ui-jqdialog",i.id=b.themodal;var l=document.createElement("div");l.className="ui-jqdialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix",l.id=b.modalhead,a(l).append("<span class='ui-jqdialog-title'>"+d.caption+"</span>");var m=a("<a href='javascript:void(0)' class='ui-jqdialog-titlebar-close ui-corner-all'></a>").hover(function(){m.addClass("ui-state-hover")},function(){m.removeClass("ui-state-hover")}).append("<span class='ui-icon ui-icon-closethick'></span>");a(l).append(m),j?(i.dir="rtl",a(".ui-jqdialog-title",l).css("float","right"),a(".ui-jqdialog-titlebar-close",l).css("left","0.3em")):(i.dir="ltr",a(".ui-jqdialog-title",l).css("float","left"),a(".ui-jqdialog-titlebar-close",l).css("right","0.3em"));var n=document.createElement("div");a(n).addClass("ui-jqdialog-content ui-widget-content").attr("id",b.modalcontent),a(n).append(c),i.appendChild(n),a(i).prepend(l),g===!0?a("body").append(i):typeof g=="string"?a(g).append(i):a(i).insertBefore(e),a(i).css(h),typeof d.jqModal=="undefined"&&(d.jqModal=!0);var o={};if(a.fn.jqm&&d.jqModal===!0){if(d.left===0&&d.top===0&&d.overlay){var p=[];p=this.findPos(f),d.left=p[0]+4,d.top=p[1]+4}o.top=d.top+"px",o.left=d.left}else if(d.left!==0||d.top!==0)o.left=d.left,o.top=d.top+"px";a("a.ui-jqdialog-titlebar-close",l).click(function(c){var e=a("#"+b.themodal).data("onClose")||d.onClose,f=a("#"+b.themodal).data("gbox")||d.gbox;k.hideModal("#"+b.themodal,{gb:f,jqm:d.jqModal,onClose:e});return!1});if(d.width===0||!d.width)d.width=300;if(d.height===0||!d.height)d.height=200;if(!d.zIndex){var q=a(e).parents("*[role=dialog]").filter(":first").css("z-index");q?d.zIndex=parseInt(q,10)+1:d.zIndex=950}var r=0;j&&o.left&&!g&&(r=a(d.gbox).width()-(isNaN(d.width)?0:parseInt(d.width,10))-8,o.left=parseInt(o.left,10)+parseInt(r,10)),o.left&&(o.left+="px"),a(i).css(a.extend({width:isNaN(d.width)?"auto":d.width+"px",height:isNaN(d.height)?"auto":d.height+"px",zIndex:d.zIndex,overflow:"hidden"},o)).attr({tabIndex:"-1",role:"dialog","aria-labelledby":b.modalhead,"aria-hidden":"true"}),typeof d.drag=="undefined"&&(d.drag=!0),typeof d.resize=="undefined"&&(d.resize=!0);if(d.drag){a(l).css("cursor","move");if(a.fn.jqDrag)a(i).jqDrag(l);else try{a(i).draggable({handle:a("#"+l.id)})}catch(s){}}if(d.resize)if(a.fn.jqResize)a(i).append("<div class='jqResize ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se ui-icon-grip-diagonal-se'></div>"),a("#"+b.themodal).jqResize(".jqResize",b.scrollelm?"#"+b.scrollelm:!1);else try{a(i).resizable({handles:"se, sw",alsoResize:b.scrollelm?"#"+b.scrollelm:!1})}catch(t){}d.closeOnEscape===!0&&a(i).keydown(function(c){if(c.which==27){var e=a("#"+b.themodal).data("onClose")||d.onClose;k.hideModal(this,{gb:d.gbox,jqm:d.jqModal,onClose:e})}})},viewModal:function(b,c){c=a.extend({toTop:!0,overlay:10,modal:!1,onShow:this.showModal,onHide:this.closeModal,gbox:"",jqm:!0,jqM:!0},c||{});if(a.fn.jqm&&c.jqm===!0)c.jqM?a(b).attr("aria-hidden","false").jqm(c).jqmShow():a(b).attr("aria-hidden","false").jqmShow();else{c.gbox!==""&&(a(".jqgrid-overlay:first",c.gbox).show(),a(b).data("gbox",c.gbox)),a(b).show().attr("aria-hidden","false");try{a(":input:visible",b)[0].focus()}catch(d){}}},info_dialog:function(b,c,d,e){var f={width:290,height:"auto",dataheight:"auto",drag:!0,resize:!1,caption:"<b>"+b+"</b>",left:250,top:170,zIndex:1e3,jqModal:!0,modal:!1,closeOnEscape:!0,align:"center",buttonalign:"center",buttons:[]};a.extend(f,e||{});var g=f.jqModal,h=this;a.fn.jqm&&!g&&(g=!1);var i="";if(f.buttons.length>0)for(var j=0;j<f.buttons.length;j++)typeof f.buttons[j].id=="undefined"&&(f.buttons[j].id="info_button_"+j),i+="<a href='javascript:void(0)' id='"+f.buttons[j].id+"' class='fm-button ui-state-default ui-corner-all'>"+f.buttons[j].text+"</a>";var k=isNaN(f.dataheight)?f.dataheight:f.dataheight+"px",l="text-align:"+f.align+";",m="<div id='info_id'>";m+="<div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:"+k+";"+l+"'>"+c+"</div>",m+=d?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+f.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'><a href='javascript:void(0)' id='closedialog' class='fm-button ui-state-default ui-corner-all'>"+d+"</a>"+i+"</div>":i!==""?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+f.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'>"+i+"</div>":"",m+="</div>";try{a("#info_dialog").attr("aria-hidden")=="false"&&this.hideModal("#info_dialog",{jqm:g}),a("#info_dialog").remove()}catch(n){}this.createModal({themodal:"info_dialog",modalhead:"info_head",modalcontent:"info_content",scrollelm:"infocnt"},m,f,"","",!0),i&&a.each(f.buttons,function(b){a("#"+this.id,"#info_id").bind("click",function(){f.buttons[b].onClick.call(a("#info_dialog"));return!1})}),a("#closedialog","#info_id").click(function(a){h.hideModal("#info_dialog",{jqm:g});return!1}),a(".fm-button","#info_dialog").hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}),a.isFunction(f.beforeOpen)&&f.beforeOpen(),this.viewModal("#info_dialog",{onHide:function(a){a.w.hide().remove(),a.o&&a.o.remove()},modal:f.modal,jqm:g}),a.isFunction(f.afterOpen)&&f.afterOpen();try{a("#info_dialog").focus()}catch(o){}},createEl:function(b,c,d,e,f){function i(b,c,d){var e=["dataInit","dataEvents","dataUrl","buildSelect","sopt","searchhidden","defaultValue","attr"];typeof d!="undefined"&&a.isArray(d)&&(e=a.extend(e,d)),a.each(c,function(c,d){a.inArray(c,e)===-1&&a(b).attr(c,d)}),c.hasOwnProperty("id")||a(b).attr("id",a.jgrid.randId())}function h(b,c){a.isFunction(c.dataInit)&&c.dataInit(b),c.dataEvents&&a.each(c.dataEvents,function(){this.data!==undefined?a(b).bind(this.type,this.data,this.fn):a(b).bind(this.type,this.fn)});return c}var g="";switch(b){case"textarea":g=document.createElement("textarea"),e?c.cols||a(g).css({width:"98%"}):c.cols||(c.cols=20),c.rows||(c.rows=2);if(d=="&nbsp;"||d=="&#160;"||d.length==1&&d.charCodeAt(0)==160)d="";g.value=d,i(g,c),c=h(g,c),a(g).attr({role:"textbox",multiline:"true"});break;case"checkbox":g=document.createElement("input"),g.type="checkbox";if(!c.value){var j=d.toLowerCase();j.search(/(false|0|no|off|undefined)/i)<0&&j!==""?(g.checked=!0,g.defaultChecked=!0,g.value=d):g.value="on",a(g).attr("offval","off")}else{var k=c.value.split(":");d===k[0]&&(g.checked=!0,g.defaultChecked=!0),g.value=k[0],a(g).attr("offval",k[1])}i(g,c,["value"]),c=h(g,c),a(g).attr("role","checkbox");break;case"select":g=document.createElement("select"),g.setAttribute("role","select");var l,m=[];c.multiple===!0?(l=!0,g.multiple="multiple",a(g).attr("aria-multiselectable","true")):l=!1;if(typeof c.dataUrl!="undefined")a.ajax(a.extend({url:c.dataUrl,type:"GET",dataType:"html",context:{elem:g,options:c,vl:d},success:function(b,c){var d,e=[],f=this.elem,g=this.vl,j=a.extend({},this.options),k=j.multiple===!0;if(typeof j.buildSelect!="undefined"){var l=j.buildSelect(b);d=a(l).html()}else d=a(b).html();d&&(a(f).append(d),i(f,j),j=h(f,j),typeof j.size=="undefined"&&(j.size=k?3:1),k?(e=g.split(","),e=a.map(e,function(b){return a.trim(b)})):e[0]=a.trim(g),setTimeout(function(){a("option",f).each(function(b){a(this).attr("role","option");if(a.inArray(a.trim(a(this).text()),e)>-1||a.inArray(a.trim(a(this).val()),e)>-1)this.selected="selected"})},0))}},f||{}));else if(c.value){var n;l?(m=d.split(","),m=a.map(m,function(b){return a.trim(b)}),typeof c.size=="undefined"&&(c.size=3)):c.size=1,typeof c.value=="function"&&(c.value=c.value());var o,p,q;if(typeof c.value=="string"){o=c.value.split(";");for(n=0;n<o.length;n++)p=o[n].split(":"),p.length>2&&(p[1]=a.map(p,function(a,b){if(b>0)return a}).join(":")),q=document.createElement("option"),q.setAttribute("role","option"),q.value=p[0],q.innerHTML=p[1],!l&&(a.trim(p[0])==a.trim(d)||a.trim(p[1])==a.trim(d))&&(q.selected="selected"),l&&(a.inArray(a.trim(p[1]),m)>-1||a.inArray(a.trim(p[0]),m)>-1)&&(q.selected="selected"),g.appendChild(q)}else if(typeof c.value=="object"){var r=c.value;for(var s in r)r.hasOwnProperty(s)&&(q=document.createElement("option"),q.setAttribute("role","option"),q.value=s,q.innerHTML=r[s],!l&&(a.trim(s)==a.trim(d)||a.trim(r[s])==a.trim(d))&&(q.selected="selected"),l&&(a.inArray(a.trim(r[s]),m)>-1||a.inArray(a.trim(s),m)>-1)&&(q.selected="selected"),g.appendChild(q))}i(g,c,["value"]),c=h(g,c)}break;case"text":case"password":case"button":var t;b=="button"?t="button":t="textbox",g=document.createElement("input"),g.type=b,g.value=d,i(g,c),c=h(g,c),b!="button"&&(e?c.size||a(g).css({width:"98%"}):c.size||(c.size=20)),a(g).attr("role",t);break;case"image":case"file":g=document.createElement("input"),g.type=b,i(g,c),c=h(g,c);break;case"custom":g=document.createElement("span");try{if(!a.isFunction(c.custom_element))throw"e1";var u=c.custom_element.call(this,d,c);if(u)u=a(u).addClass("customelement").attr({id:c.id,name:c.name}),a(g).empty().append(u);else throw"e2"}catch(v){v=="e1"&&this.info_dialog(a.jgrid.errors.errcap,"function 'custom_element' "+a.jgrid.edit.msg.nodefined,a.jgrid.edit.bClose),v=="e2"?this.info_dialog(a.jgrid.errors.errcap,"function 'custom_element' "+a.jgrid.edit.msg.novalue,a.jgrid.edit.bClose):this.info_dialog(a.jgrid.errors.errcap,typeof v=="string"?v:v.message,a.jgrid.edit.bClose)}}return g},checkDate:function(a,b){var c=function(a){return a%4===0&&(a%100!==0||a%400===0)?29:28},d=function(a){for(var b=1;b<=a;b++){this[b]=31;if(b==4||b==6||b==9||b==11)this[b]=30;b==2&&(this[b]=29)}return this},e={},f;a=a.toLowerCase(),a.indexOf("/")!=-1?f="/":a.indexOf("-")!=-1?f="-":a.indexOf(".")!=-1?f=".":f="/",a=a.split(f),b=b.split(f);if(b.length!=3)return!1;var g=-1,h,i=-1,j=-1;for(var k=0;k<a.length;k++){var l=isNaN(b[k])?0:parseInt(b[k],10);e[a[k]]=l,h=a[k],h.indexOf("y")!=-1&&(g=k),h.indexOf("m")!=-1&&(j=k),h.indexOf("d")!=-1&&(i=k)}a[g]=="y"||a[g]=="yyyy"?h=4:a[g]=="yy"?h=2:h=-1;var m=d(12),n;if(g===-1)return!1;n=e[a[g]].toString(),h==2&&n.length==1&&(h=1);if(n.length!=h||e[a[g]]===0&&b[g]!="00")return!1;if(j===-1)return!1;n=e[a[j]].toString();if(n.length<1||e[a[j]]<1||e[a[j]]>12)return!1;if(i===-1)return!1;n=e[a[i]].toString();if(n.length<1||e[a[i]]<1||e[a[i]]>31||e[a[j]]==2&&e[a[i]]>c(e[a[g]])||e[a[i]]>m[e[a[j]]])return!1;return!0},isEmpty:function(a){return a.match(/^\s+$/)||a===""?!0:!1},checkTime:function(a){var b=/^(\d{1,2}):(\d{2})([ap]m)?$/,c;if(!this.isEmpty(a)){c=a.match(b);if(!c)return!1;if(c[3]){if(c[1]<1||c[1]>12)return!1}else if(c[1]>23)return!1;if(c[2]>59)return!1}return!0},checkValues:function(b,c,d,e,f){var g,h,i,j,k;if(typeof e=="undefined")if(typeof c=="string"){for(h=0,k=d.p.colModel.length;h<k;h++)if(d.p.colModel[h].name==c){g=d.p.colModel[h].editrules,c=h;try{i=d.p.colModel[h].formoptions.label}catch(l){}break}}else c>=0&&(g=d.p.colModel[c].editrules);else g=e,i=f===undefined?"_":f;if(g){i||(i=d.p.colNames[c]);if(g.required===!0&&this.isEmpty(b))return[!1,i+": "+a.jgrid.edit.msg.required,""];var m=g.required===!1?!1:!0;if(g.number===!0&&(m!==!1||!this.isEmpty(b))&&isNaN(b))return[!1,i+": "+a.jgrid.edit.msg.number,""];if(typeof g.minValue!="undefined"&&!isNaN(g.minValue)&&parseFloat(b)<parseFloat(g.minValue))return[!1,i+": "+a.jgrid.edit.msg.minValue+" "+g.minValue,""];if(typeof g.maxValue!="undefined"&&!isNaN(g.maxValue)&&parseFloat(b)>parseFloat(g.maxValue))return[!1,i+": "+a.jgrid.edit.msg.maxValue+" "+g.maxValue,""];var n;if(g.email===!0)if(m!==!1||!this.isEmpty(b)){n=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;if(!n.test(b))return[!1,i+": "+a.jgrid.edit.msg.email,""]}if(g.integer===!0)if(m!==!1||!this.isEmpty(b)){if(isNaN(b))return[!1,i+": "+a.jgrid.edit.msg.integer,""];if(b%1!==0||b.indexOf(".")!=-1)return[!1,i+": "+a.jgrid.edit.msg.integer,""]}if(g.date===!0)if(m!==!1||!this.isEmpty(b)){d.p.colModel[c].formatoptions&&d.p.colModel[c].formatoptions.newformat?j=d.p.colModel[c].formatoptions.newformat:j=d.p.colModel[c].datefmt||"Y-m-d";if(!this.checkDate(j,b))return[!1,i+": "+a.jgrid.edit.msg.date+" - "+j,""]}if(g.time===!0&&(m!==!1||!this.isEmpty(b))&&!this.checkTime(b))return[!1,i+": "+a.jgrid.edit.msg.date+" - hh:mm (am/pm)",""];if(g.url===!0)if(m!==!1||!this.isEmpty(b)){n=/^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i;if(!n.test(b))return[!1,i+": "+a.jgrid.edit.msg.url,""]}if(g.custom===!0)if(m!==!1||!this.isEmpty(b)){if(a.isFunction(g.custom_func)){var o=g.custom_func.call(d,b,i);return a.isArray(o)?o:[!1,a.jgrid.edit.msg.customarray,""]}return[!1,a.jgrid.edit.msg.customfcheck,""]}}return[!0,"",""]}})})(jQuery)