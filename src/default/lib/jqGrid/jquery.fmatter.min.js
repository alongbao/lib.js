(function(a){a.fmatter={},a.extend(a.fmatter,{isBoolean:function(a){return typeof a=="boolean"},isObject:function(b){return b&&(typeof b=="object"||a.isFunction(b))||!1},isString:function(a){return typeof a=="string"},isNumber:function(a){return typeof a=="number"&&isFinite(a)},isNull:function(a){return a===null},isUndefined:function(a){return typeof a=="undefined"},isValue:function(a){return this.isObject(a)||this.isString(a)||this.isNumber(a)||this.isBoolean(a)},isEmpty:function(b){if(!this.isString(b)&&this.isValue(b))return!1;if(!this.isValue(b))return!0;b=a.trim(b).replace(/\&nbsp\;/ig,"").replace(/\&#160\;/ig,"");return b===""}}),a.fn.fmatter=function(b,c,d,e,f){var g=c;d=a.extend({},a.jgrid.formatter,d),a.fn.fmatter[b]&&(g=a.fn.fmatter[b](c,d,e,f));return g},a.fmatter.util={NumberFormat:function(b,c){a.fmatter.isNumber(b)||(b*=1);if(a.fmatter.isNumber(b)){var d=b<0,e=b+"",f=c.decimalSeparator?c.decimalSeparator:".",g;if(a.fmatter.isNumber(c.decimalPlaces)){var h=c.decimalPlaces,i=Math.pow(10,h);e=Math.round(b*i)/i+"",g=e.lastIndexOf(".");if(h>0){g<0?(e+=f,g=e.length-1):f!=="."&&(e=e.replace(".",f));while(e.length-1-g<h)e+="0"}}if(c.thousandsSeparator){var j=c.thousandsSeparator;g=e.lastIndexOf(f),g=g>-1?g:e.length;var k=e.substring(g),l=-1;for(var m=g;m>0;m--)l++,l%3===0&&m!==g&&(!d||m>1)&&(k=j+k),k=e.charAt(m-1)+k;e=k}e=c.prefix?c.prefix+e:e,e=c.suffix?e+c.suffix:e;return e}return b},DateFormat:function(b,c,d,e){var f=/\\.|[dDjlNSwzWFmMntLoYyaABgGhHisueIOPTZcrU]/g,g=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,h=/[^-+\dA-Z]/g,i=new RegExp("^/Date\\((([-+])?[0-9]+)(([-+])([0-9]{2})([0-9]{2}))?\\)/$"),j=typeof c=="string"?c.match(i):null,k=function(a,b){a=String(a),b=parseInt(b,10)||2;while(a.length<b)a="0"+a;return a},l={m:1,d:1,y:1970,h:0,i:0,s:0,u:0},m=0,n,o,p,q=["i18n"];q.i18n={dayNames:e.dayNames,monthNames:e.monthNames},b in e.masks&&(b=e.masks[b]);if(c.constructor===Number)String(b).toLowerCase()=="u"&&(c=c*1e3),m=new Date(c);else if(c.constructor===Date)m=c;else if(j!==null){m=new Date(parseInt(j[1],10));if(j[3]){var r=Number(j[5])*60+Number(j[6]);r*=j[4]=="-"?1:-1,r-=m.getTimezoneOffset(),m.setTime(Number(Number(m)+r*60*1e3))}}else{c=String(c).split(/[\\\/:_;.,\t\T\s-]/),b=b.split(/[\\\/:_;.,\t\T\s-]/);for(o=0,p=b.length;o<p;o++)b[o]=="M"&&(n=a.inArray(c[o],q.i18n.monthNames),n!==-1&&n<12&&(c[o]=n+1)),b[o]=="F"&&(n=a.inArray(c[o],q.i18n.monthNames),n!==-1&&n>11&&(c[o]=n+1-12)),c[o]&&(l[b[o].toLowerCase()]=parseInt(c[o],10));l.f&&(l.m=l.f);if(l.m===0&&l.y===0&&l.d===0)return"&#160;";l.m=parseInt(l.m,10)-1;var s=l.y;s>=70&&s<=99?l.y=1900+l.y:s>=0&&s<=69&&(l.y=2e3+l.y),m=new Date(l.y,l.m,l.d,l.h,l.i,l.s,l.u)}d in e.masks?d=e.masks[d]:d||(d="Y-m-d");var t=m.getHours(),u=m.getMinutes(),v=m.getDate(),w=m.getMonth()+1,x=m.getTimezoneOffset(),y=m.getSeconds(),z=m.getMilliseconds(),A=m.getDay(),B=m.getFullYear(),C=(A+6)%7+1,D=(new Date(B,w-1,v)-new Date(B,0,1))/864e5,E={d:k(v),D:q.i18n.dayNames[A],j:v,l:q.i18n.dayNames[A+7],N:C,S:e.S(v),w:A,z:D,W:C<5?Math.floor((D+C-1)/7)+1:Math.floor((D+C-1)/7)||(((new Date(B-1,0,1)).getDay()+6)%7<4?53:52),F:q.i18n.monthNames[w-1+12],m:k(w),M:q.i18n.monthNames[w-1],n:w,t:"?",L:"?",o:"?",Y:B,y:String(B).substring(2),a:t<12?e.AmPm[0]:e.AmPm[1],A:t<12?e.AmPm[2]:e.AmPm[3],B:"?",g:t%12||12,G:t,h:k(t%12||12),H:k(t),i:k(u),s:k(y),u:z,e:"?",I:"?",O:(x>0?"-":"+")+k(Math.floor(Math.abs(x)/60)*100+Math.abs(x)%60,4),P:"?",T:(String(m).match(g)||[""]).pop().replace(h,""),Z:"?",c:"?",r:"?",U:Math.floor(m/1e3)};return d.replace(f,function(a){return a in E?E[a]:a.substring(1)})}},a.fn.fmatter.defaultFormat=function(b,c){return a.fmatter.isValue(b)&&b!==""?b:c.defaultValue?c.defaultValue:"&#160;"},a.fn.fmatter.email=function(b,c){return a.fmatter.isEmpty(b)?a.fn.fmatter.defaultFormat(b,c):'<a href="mailto:'+b+'">'+b+"</a>"},a.fn.fmatter.checkbox=function(b,c){var d=a.extend({},c.checkbox),e;a.fmatter.isUndefined(c.colModel.formatoptions)||(d=a.extend({},d,c.colModel.formatoptions)),d.disabled===!0?e='disabled="disabled"':e="";if(a.fmatter.isEmpty(b)||a.fmatter.isUndefined(b))b=a.fn.fmatter.defaultFormat(b,d);b=b+"",b=b.toLowerCase();var f=b.search(/(false|0|no|off)/i)<0?" checked='checked' ":"";return'<input type="checkbox" '+f+' value="'+b+'" offval="no" '+e+"/>"},a.fn.fmatter.link=function(b,c){var d={target:c.target},e="";a.fmatter.isUndefined(c.colModel.formatoptions)||(d=a.extend({},d,c.colModel.formatoptions)),d.target&&(e="target="+d.target);return a.fmatter.isEmpty(b)?a.fn.fmatter.defaultFormat(b,c):"<a "+e+' href="'+b+'">'+b+"</a>"},a.fn.fmatter.showlink=function(b,c){var d={baseLinkUrl:c.baseLinkUrl,showAction:c.showAction,addParam:c.addParam||"",target:c.target,idName:c.idName},e="",f;a.fmatter.isUndefined(c.colModel.formatoptions)||(d=a.extend({},d,c.colModel.formatoptions)),d.target&&(e="target="+d.target),f=d.baseLinkUrl+d.showAction+"?"+d.idName+"="+c.rowId+d.addParam;return a.fmatter.isString(b)||a.fmatter.isNumber(b)?"<a "+e+' href="'+f+'">'+b+"</a>":a.fn.fmatter.defaultFormat(b,c)},a.fn.fmatter.integer=function(b,c){var d=a.extend({},c.integer);a.fmatter.isUndefined(c.colModel.formatoptions)||(d=a.extend({},d,c.colModel.formatoptions));if(a.fmatter.isEmpty(b))return d.defaultValue;return a.fmatter.util.NumberFormat(b,d)},a.fn.fmatter.number=function(b,c){var d=a.extend({},c.number);a.fmatter.isUndefined(c.colModel.formatoptions)||(d=a.extend({},d,c.colModel.formatoptions));if(a.fmatter.isEmpty(b))return d.defaultValue;return a.fmatter.util.NumberFormat(b,d)},a.fn.fmatter.currency=function(b,c){var d=a.extend({},c.currency);a.fmatter.isUndefined(c.colModel.formatoptions)||(d=a.extend({},d,c.colModel.formatoptions));if(a.fmatter.isEmpty(b))return d.defaultValue;return a.fmatter.util.NumberFormat(b,d)},a.fn.fmatter.date=function(b,c,d,e){var f=a.extend({},c.date);a.fmatter.isUndefined(c.colModel.formatoptions)||(f=a.extend({},f,c.colModel.formatoptions));return!f.reformatAfterEdit&&e=="edit"?a.fn.fmatter.defaultFormat(b,c):a.fmatter.isEmpty(b)?a.fn.fmatter.defaultFormat(b,c):a.fmatter.util.DateFormat(f.srcformat,b,f.newformat,f)},a.fn.fmatter.select=function(b,c,d,e){b=b+"";var f=!1,g=[];a.fmatter.isUndefined(c.colModel.formatoptions)?a.fmatter.isUndefined(c.colModel.editoptions)||(f=c.colModel.editoptions.value):f=c.colModel.formatoptions.value;if(f){var h=c.colModel.editoptions.multiple===!0?!0:!1,i=[],j;h&&(i=b.split(","),i=a.map(i,function(b){return a.trim(b)}));if(a.fmatter.isString(f)){var k=f.split(";"),l=0;for(var m=0;m<k.length;m++){j=k[m].split(":"),j.length>2&&(j[1]=jQuery.map(j,function(a,b){if(b>0)return a}).join(":"));if(h)jQuery.inArray(j[0],i)>-1&&(g[l]=j[1],l++);else if(a.trim(j[0])==a.trim(b)){g[0]=j[1];break}}}else a.fmatter.isObject(f)&&(h?g=jQuery.map(i,function(a,b){return f[a]}):g[0]=f[b]||"")}b=g.join(", ");return b===""?a.fn.fmatter.defaultFormat(b,c):b},a.fn.fmatter.rowactions=function(b,c,d,e){var f={keys:!1,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{oper:"edit"},url:null,delOptions:{},editOptions:{}};b=a.jgrid.jqID(b),c=a.jgrid.jqID(c);var g=a("#"+c)[0].p.colModel[e];a.fmatter.isUndefined(g.formatoptions)||(f=a.extend(f,g.formatoptions)),a.fmatter.isUndefined(a("#"+c)[0].p.editOptions)||(f.editOptions=a("#"+c)[0].p.editOptions),a.fmatter.isUndefined(a("#"+c)[0].p.delOptions)||(f.delOptions=a("#"+c)[0].p.delOptions);var h=function(d){f.afterSave&&f.afterSave(d),a("tr#"+b+" div.ui-inline-edit, "+"tr#"+b+" div.ui-inline-del","#"+c+".ui-jqgrid-btable:first").show(),a("tr#"+b+" div.ui-inline-save, "+"tr#"+b+" div.ui-inline-cancel","#"+c+".ui-jqgrid-btable:first").hide()},i=function(d){f.afterRestore&&f.afterRestore(d),a("tr#"+b+" div.ui-inline-edit, "+"tr#"+b+" div.ui-inline-del","#"+c+".ui-jqgrid-btable:first").show(),a("tr#"+b+" div.ui-inline-save, "+"tr#"+b+" div.ui-inline-cancel","#"+c+".ui-jqgrid-btable:first").hide()};switch(d){case"edit":a("#"+c).jqGrid("editRow",b,f.keys,f.onEdit,f.onSuccess,f.url,f.extraparam,h,f.onError,i),a("tr#"+b+" div.ui-inline-edit, "+"tr#"+b+" div.ui-inline-del","#"+c+".ui-jqgrid-btable:first").hide(),a("tr#"+b+" div.ui-inline-save, "+"tr#"+b+" div.ui-inline-cancel","#"+c+".ui-jqgrid-btable:first").show();break;case"save":a("#"+c).jqGrid("saveRow",b,f.onSuccess,f.url,f.extraparam,h,f.onError,i)&&(a("tr#"+b+" div.ui-inline-edit, "+"tr#"+b+" div.ui-inline-del","#"+c+".ui-jqgrid-btable:first").show(),a("tr#"+b+" div.ui-inline-save, "+"tr#"+b+" div.ui-inline-cancel","#"+c+".ui-jqgrid-btable:first").hide());break;case"cancel":a("#"+c).jqGrid("restoreRow",b,i),a("tr#"+b+" div.ui-inline-edit, "+"tr#"+b+" div.ui-inline-del","#"+c+".ui-jqgrid-btable:first").show(),a("tr#"+b+" div.ui-inline-save, "+"tr#"+b+" div.ui-inline-cancel","#"+c+".ui-jqgrid-btable:first").hide();break;case"del":a("#"+c).jqGrid("delGridRow",b,f.delOptions);break;case"formedit":a("#"+c).jqGrid("setSelection",b),a("#"+c).jqGrid("editGridRow",b,f.editOptions)}},a.fn.fmatter.actions=function(b,c,d){var e={keys:!1,editbutton:!0,delbutton:!0,editformbutton:!1};a.fmatter.isUndefined(c.colModel.formatoptions)||(e=a.extend(e,c.colModel.formatoptions));var f=c.rowId,g="",h;if(typeof f=="undefined"||a.fmatter.isEmpty(f))return"";e.editformbutton?(h="onclick=$.fn.fmatter.rowactions('"+f+"','"+c.gid+"','formedit',"+c.pos+"); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); ",g=g+"<div title='"+a.jgrid.nav.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+h+"><span class='ui-icon ui-icon-pencil'></span></div>"):e.editbutton&&(h="onclick=$.fn.fmatter.rowactions('"+f+"','"+c.gid+"','edit',"+c.pos+"); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover') ",g=g+"<div title='"+a.jgrid.nav.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+h+"><span class='ui-icon ui-icon-pencil'></span></div>"),e.delbutton&&(h="onclick=$.fn.fmatter.rowactions('"+f+"','"+c.gid+"','del',"+c.pos+"); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); ",g=g+"<div title='"+a.jgrid.nav.deltitle+"' style='float:left;margin-left:5px;' class='ui-pg-div ui-inline-del' "+h+"><span class='ui-icon ui-icon-trash'></span></div>"),h="onclick=$.fn.fmatter.rowactions('"+f+"','"+c.gid+"','save',"+c.pos+"); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); ",g=g+"<div title='"+a.jgrid.edit.bSubmit+"' style='float:left;display:none' class='ui-pg-div ui-inline-save' "+h+"><span class='ui-icon ui-icon-disk'></span></div>",h="onclick=$.fn.fmatter.rowactions('"+f+"','"+c.gid+"','cancel',"+c.pos+"); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); ",g=g+"<div title='"+a.jgrid.edit.bCancel+"' style='float:left;display:none;margin-left:5px;' class='ui-pg-div ui-inline-cancel' "+h+"><span class='ui-icon ui-icon-cancel'></span></div>";return"<div style='margin-left:8px;'>"+g+"</div>"},a.unformat=function(b,c,d,e){var f,g=c.colModel.formatter,h=c.colModel.formatoptions||{},i,j=/([\.\*\_\'\(\)\{\}\+\?\\])/g,k=c.colModel.unformat||a.fn.fmatter[g]&&a.fn.fmatter[g].unformat;if(typeof k!="undefined"&&a.isFunction(k))f=k(a(b).text(),c,b);else if(!a.fmatter.isUndefined(g)&&a.fmatter.isString(g)){var l=a.jgrid.formatter||{},m;switch(g){case"integer":h=a.extend({},l.integer,h),i=h.thousandsSeparator.replace(j,"\\$1"),m=new RegExp(i,"g"),f=a(b).text().replace(m,"");break;case"number":h=a.extend({},l.number,h),i=h.thousandsSeparator.replace(j,"\\$1"),m=new RegExp(i,"g"),f=a(b).text().replace(m,"").replace(h.decimalSeparator,".");break;case"currency":h=a.extend({},l.currency,h),i=h.thousandsSeparator.replace(j,"\\$1"),m=new RegExp(i,"g"),f=a(b).text().replace(m,"").replace(h.decimalSeparator,".").replace(h.prefix,"").replace(h.suffix,"");break;case"checkbox":var n=c.colModel.editoptions?c.colModel.editoptions.value.split(":"):["Yes","No"];f=a("input",b).attr("checked")?n[0]:n[1];break;case"select":f=a.unformat.select(b,c,d,e);break;case"actions":return"";default:f=a(b).text()}}return f!==undefined?f:e===!0?a(b).text():a.jgrid.htmlDecode(a(b).html())},a.unformat.select=function(b,c,d,e){var f=[],g=a(b).text();if(e===!0)return g;var h=a.extend({},c.colModel.editoptions);if(h.value){var i=h.value,j=h.multiple===!0?!0:!1,k=[],l;j&&(k=g.split(","),k=a.map(k,function(b){return a.trim(b)}));if(a.fmatter.isString(i)){var m=i.split(";"),n=0;for(var o=0;o<m.length;o++){l=m[o].split(":"),l.length>2&&(l[1]=jQuery.map(l,function(a,b){if(b>0)return a}).join(":"));if(j)jQuery.inArray(l[1],k)>-1&&(f[n]=l[0],n++);else if(a.trim(l[1])==a.trim(g)){f[0]=l[0];break}}}else if(a.fmatter.isObject(i)||a.isArray(i))j||(k[0]=g),f=jQuery.map(k,function(b){var c;a.each(i,function(a,d){if(d==b){c=a;return!1}});if(typeof c!="undefined")return c});return f.join(", ")}return g||""},a.unformat.date=function(b,c){var d=a.jgrid.formatter.date||{};a.fmatter.isUndefined(c.formatoptions)||(d=a.extend({},d,c.formatoptions));return a.fmatter.isEmpty(b)?a.fn.fmatter.defaultFormat(b,c):a.fmatter.util.DateFormat(d.newformat,b,d.srcformat,d)}})(jQuery)