(function(a){a.jgrid.extend({jqGridImport:function(b){b=a.extend({imptype:"xml",impstring:"",impurl:"",mtype:"GET",impData:{},xmlGrid:{config:"roots>grid",data:"roots>rows"},jsonGrid:{config:"grid",data:"data"},ajaxOptions:{}},b||{});return this.each(function(){var c=this,d=function(b,d){var e=a(d.xmlGrid.config,b)[0],f=a(d.xmlGrid.data,b)[0],g,h;if(xmlJsonClass.xml2json&&a.jgrid.parse){g=xmlJsonClass.xml2json(e," "),g=a.jgrid.parse(g);for(var i in g)g.hasOwnProperty(i)&&(h=g[i]);if(f){var j=g.grid.datatype;g.grid.datatype="xmlstring",g.grid.datastr=b,a(c).jqGrid(h).jqGrid("setGridParam",{datatype:j})}else a(c).jqGrid(h);g=null,h=null}else alert("xml2json or parse are not present")},e=function(b,d){if(b&&typeof b=="string"){var e=a.jgrid.parse(b),f=e[d.jsonGrid.config],g=e[d.jsonGrid.data];if(g){var h=f.datatype;f.datatype="jsonstring",f.datastr=g,a(c).jqGrid(f).jqGrid("setGridParam",{datatype:h})}else a(c).jqGrid(f)}};switch(b.imptype){case"xml":a.ajax(a.extend({url:b.impurl,type:b.mtype,data:b.impData,dataType:"xml",complete:function(c,e){e=="success"&&(d(c.responseXML,b),a.isFunction(b.importComplete)&&b.importComplete(c)),c=null}},b.ajaxOptions));break;case"xmlstring":if(b.impstring&&typeof b.impstring=="string"){var f=a.jgrid.stringToDoc(b.impstring);f&&(d(f,b),a.isFunction(b.importComplete)&&b.importComplete(f),b.impstring=null),f=null}break;case"json":a.ajax(a.extend({url:b.impurl,type:b.mtype,data:b.impData,dataType:"json",complete:function(c,d){d=="success"&&(e(c.responseText,b),a.isFunction(b.importComplete)&&b.importComplete(c)),c=null}},b.ajaxOptions));break;case"jsonstring":b.impstring&&typeof b.impstring=="string"&&(e(b.impstring,b),a.isFunction(b.importComplete)&&b.importComplete(b.impstring),b.impstring=null)}})},jqGridExport:function(b){b=a.extend({exptype:"xmlstring",root:"grid",ident:"\t"},b||{});var c=null;this.each(function(){if(!!this.grid){var d=a.extend({},a(this).jqGrid("getGridParam"));d.rownumbers&&(d.colNames.splice(0,1),d.colModel.splice(0,1)),d.multiselect&&(d.colNames.splice(0,1),d.colModel.splice(0,1)),d.subGrid&&(d.colNames.splice(0,1),d.colModel.splice(0,1)),d.knv=null;if(d.treeGrid)for(var e in d.treeReader)d.treeReader.hasOwnProperty(e)&&(d.colNames.splice(d.colNames.length-1),d.colModel.splice(d.colModel.length-1));switch(b.exptype){case"xmlstring":c="<"+b.root+">"+xmlJsonClass.json2xml(d,b.ident)+"</"+b.root+">";break;case"jsonstring":c="{"+xmlJsonClass.toJson(d,b.root,b.ident,!1)+"}",d.postData.filters!==undefined&&(c=c.replace(/filters":"/,'filters":'),c=c.replace(/}]}"/,"}]}"))}}});return c},excelExport:function(b){b=a.extend({exptype:"remote",url:null,oper:"oper",tag:"excel",exportOptions:{}},b||{});return this.each(function(){if(!!this.grid){var c;if(b.exptype=="remote"){var d=a.extend({},this.p.postData);d[b.oper]=b.tag;var e=jQuery.param(d);b.url.indexOf("?")!=-1?c=b.url+"&"+e:c=b.url+"?"+e,window.location=c}}})}})})(jQuery)