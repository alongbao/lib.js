(function(a){a.jgrid.extend({groupingSetup:function(){return this.each(function(){var b=this,c=b.p.groupingView;if(c===null||typeof c!="object"&&!a.isFunction(c))b.p.grouping=!1;else if(!c.groupField.length)b.p.grouping=!1;else{typeof c.visibiltyOnNextGrouping=="undefined"&&(c.visibiltyOnNextGrouping=[]);for(var d=0;d<c.groupField.length;d++){c.groupOrder[d]||(c.groupOrder[d]="asc"),c.groupText[d]||(c.groupText[d]="{0}"),typeof c.groupColumnShow[d]!="boolean"&&(c.groupColumnShow[d]=!0),typeof c.groupSummary[d]!="boolean"&&(c.groupSummary[d]=!1),c.groupColumnShow[d]===!0?(c.visibiltyOnNextGrouping[d]=!0,a(b).jqGrid("showCol",c.groupField[d])):(c.visibiltyOnNextGrouping[d]=a("#"+b.p.id+"_"+c.groupField[d]).is(":visible"),a(b).jqGrid("hideCol",c.groupField[d])),c.sortitems[d]=[],c.sortnames[d]=[],c.summaryval[d]=[];if(c.groupSummary[d]){c.summary[d]=[];var e=b.p.colModel;for(var f=0,g=e.length;f<g;f++)e[f].summaryType&&c.summary[d].push({nm:e[f].name,st:e[f].summaryType,v:""})}}b.p.scroll=!1,b.p.rownumbers=!1,b.p.subGrid=!1,b.p.treeGrid=!1,b.p.gridview=!0}})},groupingPrepare:function(b,c,d,e){this.each(function(){c[0]+="";var f=c[0].toString().split(" ").join(""),g=this.p.groupingView,h=this;d.hasOwnProperty(f)?d[f].push(b):(d[f]=[],d[f].push(b),g.sortitems[0].push(f),g.sortnames[0].push(a.trim(c[0].toString())),g.summaryval[0][f]=a.extend(!0,[],g.summary[0])),g.groupSummary[0]&&a.each(g.summaryval[0][f],function(b,c){a.isFunction(this.st)?this.v=this.st.call(h,this.v,this.nm,e):this.v=a(h).jqGrid("groupingCalculations."+this.st,this.v,this.nm,e)})});return d},groupingToggle:function(b){this.each(function(){var c=this,d=c.p.groupingView,e=b.lastIndexOf("_"),f=b.substring(0,e+1),g=parseInt(b.substring(e+1),10)+1,h=d.minusicon,i=d.plusicon,j=a("#"+b),k=j.length?j[0].nextSibling:null,l=a("#"+b+" span."+"tree-wrap-"+c.p.direction),m=!1;if(l.hasClass(h)){if(d.showSummaryOnHide&&d.groupSummary[0]){if(k)while(k){if(a(k).hasClass("jqfoot"))break;a(k).hide(),k=k.nextSibling}}else if(k)while(k){if(a(k).attr("id")==f+String(g))break;a(k).hide(),k=k.nextSibling}l.removeClass(h).addClass(i),m=!0}else{if(k)while(k){if(a(k).attr("id")==f+String(g))break;a(k).show(),k=k.nextSibling}l.removeClass(i).addClass(h),m=!1}a.isFunction(c.p.onClickGroup)&&c.p.onClickGroup.call(c,b,m)});return!1},groupingRender:function(b,c){return this.each(function(){var d=this,e=d.p.groupingView,f="",g="",h,i="",j,k,l;e.groupDataSorted||(e.sortitems[0].sort(),e.sortnames[0].sort(),e.groupOrder[0].toLowerCase()=="desc"&&(e.sortitems[0].reverse(),e.sortnames[0].reverse())),e.groupCollapse?i=e.plusicon:i=e.minusicon,i+=" tree-wrap-"+d.p.direction,l=0;while(l<c){if(d.p.colModel[l].name==e.groupField[0]){k=l;break}l++}a.each(e.sortitems[0],function(l,m){h=d.p.id+"ghead_"+l,g="<span style='cursor:pointer;' class='ui-icon "+i+"' onclick=\"jQuery('#"+d.p.id+"').jqGrid('groupingToggle','"+h+"');return false;\"></span>";try{j=d.formatter(h,e.sortnames[0][l],k,e.sortitems[0])}catch(n){j=e.sortnames[0][l]}f+='<tr id="'+h+'" role="row" class= "ui-widget-content jqgroup ui-row-'+d.p.direction+'"><td colspan="'+c+'">'+g+a.jgrid.format(e.groupText[0],j,b[m].length)+"</td></tr>";for(var o=0;o<b[m].length;o++)f+=b[m][o].join("");if(e.groupSummary[0]){var p="";e.groupCollapse&&!e.showSummaryOnHide&&(p=' style="display:none;"'),f+="<tr"+p+' role="row" class="ui-widget-content jqfoot ui-row-'+d.p.direction+'">';var q=e.summaryval[0][m],r=d.p.colModel,s,t=b[m].length;for(var u=0;u<c;u++){var v="<td "+d.formatCol(u,1,"")+">&#160;</td>",w="{0}";a.each(q,function(){if(this.nm==r[u].name){r[u].summaryTpl&&(w=r[u].summaryTpl),this.st=="avg"&&this.v&&t>0&&(this.v=this.v/t);try{s=d.formatter("",this.v,u,this)}catch(b){s=this.v}v="<td "+d.formatCol(u,1,"")+">"+a.jgrid.format(w,s)+"</td>";return!1}}),f+=v}f+="</tr>"}}),a("#"+d.p.id+" tbody:first").append(f),f=null})},groupingGroupBy:function(b,c,d){return this.each(function(){var d=this;typeof b=="string"&&(b=[b]);var e=d.p.groupingView;d.p.grouping=!0;for(var f=0;f<e.groupField.length;f++)!e.groupColumnShow[f]&&e.visibiltyOnNextGrouping[f]&&a(d).jqGrid("showCol",e.groupField[f]);for(var f=0;f<b.length;f++)e.visibiltyOnNextGrouping[f]=a("#"+d.p.id+"_"+b[f]).is(":visible");d.p.groupingView=a.extend(d.p.groupingView,c||{}),e.groupField=b,a(d).trigger("reloadGrid")})},groupingRemove:function(b){return this.each(function(){var c=this;typeof b=="undefined"&&(b=!0),c.p.grouping=!1;if(b===!0){var d=c.p.groupingView;for(var e=0;e<d.groupField.length;e++)!d.groupColumnShow[e]&&d.visibiltyOnNextGrouping[e]&&a(c).jqGrid("showCol",d.groupField);a("tr.jqgroup, tr.jqfoot","#"+c.p.id+" tbody:first").remove(),a("tr.jqgrow:hidden","#"+c.p.id+" tbody:first").show()}else a(c).trigger("reloadGrid")})},groupingCalculations:{sum:function(a,b,c){return parseFloat(a||0)+parseFloat(c[b]||0)},min:function(a,b,c){if(a==="")return parseFloat(c[b]||0);return Math.min(parseFloat(a),parseFloat(c[b]||0))},max:function(a,b,c){if(a==="")return parseFloat(c[b]||0);return Math.max(parseFloat(a),parseFloat(c[b]||0))},count:function(a,b,c){a===""&&(a=0);return c.hasOwnProperty(b)?a+1:0},avg:function(a,b,c){return parseFloat(a||0)+parseFloat(c[b]||0)}}})})(jQuery)